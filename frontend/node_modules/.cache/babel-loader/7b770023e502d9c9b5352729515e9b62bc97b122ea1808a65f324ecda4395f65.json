{"ast":null,"code":"import \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.some.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.some.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport { createRouter, createWebHistory } from 'vue-router';\nimport store from '../store';\nvar routes = [{\n  path: '/',\n  name: 'HomePage',\n  component: function component() {\n    return import('../views/Home.vue');\n  }\n}, {\n  path: '/login',\n  name: 'LoginPage',\n  component: function component() {\n    return import('../views/Login.vue');\n  }\n}, {\n  path: '/register',\n  name: 'RegisterPage',\n  component: function component() {\n    return import('../views/Register.vue');\n  }\n},\n// 学生路由\n{\n  path: '/student',\n  component: function component() {\n    return import('../views/student/Layout.vue');\n  },\n  meta: {\n    requiresAuth: true,\n    role: 'student'\n  },\n  children: [{\n    path: 'dashboard',\n    name: 'StudentDashboard',\n    component: function component() {\n      return import('../views/student/Dashboard.vue');\n    },\n    meta: {\n      title: '首页'\n    }\n  }, {\n    path: 'profile',\n    name: 'StudentProfile',\n    component: function component() {\n      return import('../views/student/Profile.vue');\n    },\n    meta: {\n      title: '个人信息'\n    }\n  }, {\n    path: 'seat-map',\n    name: 'SeatMap',\n    component: function component() {\n      return import('../views/student/SeatMap.vue');\n    },\n    meta: {\n      title: '座位预约'\n    }\n  }, {\n    path: 'reservations',\n    name: 'MyReservations',\n    component: function component() {\n      return import('../views/student/MyReservations.vue');\n    },\n    meta: {\n      title: '我的预约'\n    }\n  }, {\n    path: 'check-in',\n    name: 'CheckIn',\n    component: function component() {\n      return import('../views/student/CheckIn.vue');\n    },\n    meta: {\n      title: '签到/签退'\n    }\n  }]\n},\n// 管理员路由\n{\n  path: '/admin',\n  component: function component() {\n    return import('../views/admin/Layout.vue');\n  },\n  meta: {\n    requiresAuth: true,\n    role: 'admin'\n  },\n  children: [{\n    path: 'dashboard',\n    name: 'AdminDashboard',\n    component: function component() {\n      return import('../views/admin/Dashboard.vue');\n    },\n    meta: {\n      title: '管理后台'\n    }\n  }, {\n    path: 'users',\n    name: 'UserManagement',\n    component: function component() {\n      return import('../views/admin/UserManagement.vue');\n    },\n    meta: {\n      title: '用户管理'\n    }\n  }, {\n    path: 'facility',\n    name: 'FacilityManagement',\n    component: function component() {\n      return import('../views/admin/FacilityManagement.vue');\n    },\n    meta: {\n      title: '设施管理'\n    }\n  }, {\n    path: 'study-rooms',\n    name: 'StudyRoomManagement',\n    component: function component() {\n      return import('../views/admin/StudyRoomManagement.vue');\n    },\n    meta: {\n      title: '自习室管理'\n    }\n  }, {\n    path: 'reports',\n    name: 'Reports',\n    component: function component() {\n      return import('../views/admin/Reports.vue');\n    },\n    meta: {\n      title: '统计报表'\n    }\n  }]\n},\n// 404页面\n{\n  path: '/:pathMatch(.*)*',\n  name: 'NotFound',\n  component: function component() {\n    return import('../views/NotFound.vue');\n  }\n}];\nvar router = createRouter({\n  history: createWebHistory(),\n  routes: routes\n});\n\n// 路由守卫 - 添加日志\nrouter.beforeEach(function (to, from, next) {\n  console.log(\"Navigating to: \".concat(to.path)); // Log target path\n  console.log('Route requires auth?:', to.matched.some(function (record) {\n    return record.meta.requiresAuth;\n  }));\n  console.log('Is authenticated?:', store.getters.isAuthenticated);\n  console.log('Current user in store:', store.getters.currentUser);\n  console.log('Target route meta role:', to.meta.role);\n\n  // 需要认证的页面\n  if (to.matched.some(function (record) {\n    return record.meta.requiresAuth;\n  })) {\n    var _store$getters$curren;\n    // 未登录，跳转到登录页\n    if (!store.getters.isAuthenticated) {\n      console.log('Guard decision: Not authenticated, redirecting to /login');\n      next({\n        path: '/login',\n        query: {\n          redirect: to.fullPath\n        }\n      });\n      return;\n    }\n\n    // 角色检查\n    var userRole = (_store$getters$curren = store.getters.currentUser) === null || _store$getters$curren === void 0 ? void 0 : _store$getters$curren.role;\n    console.log('User role from store:', userRole);\n    if (to.meta.role && to.meta.role !== userRole) {\n      // 如果角色不匹配，根据当前存储的角色重定向到对应的 dashboard\n      var redirectPath = userRole === 'admin' ? '/admin/dashboard' : '/student/dashboard';\n      console.log(\"Guard decision: Role mismatch (Route: \".concat(to.meta.role, \", User: \").concat(userRole, \"), redirecting to \").concat(redirectPath));\n      next({\n        path: redirectPath\n      });\n      return;\n    }\n    console.log('Guard decision: Authenticated and role matches (or no role check needed).');\n  }\n  console.log('Guard decision: Proceeding with next()');\n  next(); // <--- 确保 next() 总是在某个分支被调用\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","store","routes","path","name","component","meta","requiresAuth","role","children","title","router","history","beforeEach","to","from","next","console","log","concat","matched","some","record","getters","isAuthenticated","currentUser","_store$getters$curren","query","redirect","fullPath","userRole","redirectPath"],"sources":["/Users/jeremiahncross/Documents/code/ymzxs/frontend/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\nimport store from '../store'\n\nconst routes = [\n  {\n    path: '/',\n    name: 'HomePage',\n    component: () => import('../views/Home.vue')\n  },\n  {\n    path: '/login',\n    name: 'LoginPage',\n    component: () => import('../views/Login.vue')\n  },\n  {\n    path: '/register',\n    name: 'RegisterPage',\n    component: () => import('../views/Register.vue')\n  },\n  // 学生路由\n  {\n    path: '/student',\n    component: () => import('../views/student/Layout.vue'),\n    meta: { requiresAuth: true, role: 'student' },\n    children: [\n      {\n        path: 'dashboard',\n        name: 'StudentDashboard',\n        component: () => import('../views/student/Dashboard.vue'),\n        meta: { title: '首页' }\n      },\n      {\n        path: 'profile',\n        name: 'StudentProfile',\n        component: () => import('../views/student/Profile.vue'),\n        meta: { title: '个人信息' }\n      },\n      {\n        path: 'seat-map',\n        name: 'SeatMap',\n        component: () => import('../views/student/SeatMap.vue'),\n        meta: { title: '座位预约' }\n      },\n      {\n        path: 'reservations',\n        name: 'MyReservations',\n        component: () => import('../views/student/MyReservations.vue'),\n        meta: { title: '我的预约' }\n      },\n      {\n        path: 'check-in',\n        name: 'CheckIn',\n        component: () => import('../views/student/CheckIn.vue'),\n        meta: { title: '签到/签退' }\n      }\n    ]\n  },\n  // 管理员路由\n  {\n    path: '/admin',\n    component: () => import('../views/admin/Layout.vue'),\n    meta: { requiresAuth: true, role: 'admin' },\n    children: [\n      {\n        path: 'dashboard',\n        name: 'AdminDashboard',\n        component: () => import('../views/admin/Dashboard.vue'),\n        meta: { title: '管理后台' }\n      },\n      {\n        path: 'users',\n        name: 'UserManagement',\n        component: () => import('../views/admin/UserManagement.vue'),\n        meta: { title: '用户管理' }\n      },\n      {\n        path: 'facility',\n        name: 'FacilityManagement',\n        component: () => import('../views/admin/FacilityManagement.vue'),\n        meta: { title: '设施管理' }\n      },\n      {\n        path: 'study-rooms',\n        name: 'StudyRoomManagement',\n        component: () => import('../views/admin/StudyRoomManagement.vue'),\n        meta: { title: '自习室管理' }\n      },\n      {\n        path: 'reports',\n        name: 'Reports',\n        component: () => import('../views/admin/Reports.vue'),\n        meta: { title: '统计报表' }\n      }\n    ]\n  },\n  // 404页面\n  {\n    path: '/:pathMatch(.*)*',\n    name: 'NotFound',\n    component: () => import('../views/NotFound.vue')\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n})\n\n// 路由守卫 - 添加日志\nrouter.beforeEach((to, from, next) => {\n  console.log(`Navigating to: ${to.path}`); // Log target path\n  console.log('Route requires auth?:', to.matched.some(record => record.meta.requiresAuth));\n  console.log('Is authenticated?:', store.getters.isAuthenticated);\n  console.log('Current user in store:', store.getters.currentUser);\n  console.log('Target route meta role:', to.meta.role);\n  \n  // 需要认证的页面\n  if (to.matched.some(record => record.meta.requiresAuth)) {\n    // 未登录，跳转到登录页\n    if (!store.getters.isAuthenticated) {\n      console.log('Guard decision: Not authenticated, redirecting to /login');\n      next({\n        path: '/login',\n        query: { redirect: to.fullPath }\n      });\n      return;\n    }\n    \n    // 角色检查\n    const userRole = store.getters.currentUser?.role;\n    console.log('User role from store:', userRole);\n    if (to.meta.role && to.meta.role !== userRole) {\n      // 如果角色不匹配，根据当前存储的角色重定向到对应的 dashboard\n      const redirectPath = userRole === 'admin' ? '/admin/dashboard' : '/student/dashboard';\n      console.log(`Guard decision: Role mismatch (Route: ${to.meta.role}, User: ${userRole}), redirecting to ${redirectPath}`);\n      next({ path: redirectPath });\n      return;\n    }\n    console.log('Guard decision: Authenticated and role matches (or no role check needed).');\n  }\n  \n  console.log('Guard decision: Proceeding with next()');\n  next(); // <--- 确保 next() 总是在某个分支被调用\n});\n\nexport default router "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}